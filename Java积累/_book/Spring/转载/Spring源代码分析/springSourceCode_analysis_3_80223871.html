
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>(转)Spring源码分析(三)Spring是如何把元素解析成BeanDefinition对象的 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="springSourceCode_analysis_4_80226375.html" />
    
    
    <link rel="prev" href="springSourceCode_analysis_2_80169701.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Java基础
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" >
            
                <span>
            
                    
                    线程池
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" >
            
                <span>
            
                    
                    转载
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.1" data-path="../../../Java基础/线程池/转载/threadprool_work_code_analysis_2019-07-26.html">
            
                <a href="../../../Java基础/线程池/转载/threadprool_work_code_analysis_2019-07-26.html">
            
                    
                    线程池的工作原理与源码解读
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    锁
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    分布式锁
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" >
            
                <span>
            
                    
                    Redis分布式锁
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1.1" data-path="../../../锁/分布式锁/Redis分布式锁/Redis分布式锁实现方式1.html">
            
                <a href="../../../锁/分布式锁/Redis分布式锁/Redis分布式锁实现方式1.html">
            
                    
                    Redis分布式锁实现方式1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.2" data-path="../../../锁/分布式锁/Redis分布式锁/Redis分布式锁实现方式2.html">
            
                <a href="../../../锁/分布式锁/Redis分布式锁/Redis分布式锁实现方式2.html">
            
                    
                    Redis分布式锁实现方式2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    数据库
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    MySql
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../../../数据库/MySql/转载/mysql_isolation_2019-07-12.html">
            
                <a href="../../../数据库/MySql/转载/mysql_isolation_2019-07-12.html">
            
                    
                    mysql/mariadb知识点总结：事务隔离级别
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../../../数据库/MySql/转载/mysql_undo_redo_log_2019-07-15.html">
            
                <a href="../../../数据库/MySql/转载/mysql_undo_redo_log_2019-07-15.html">
            
                    
                    mysql的undo log和redo log
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Spring
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <span>
            
                    
                    源码
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" >
            
                <span>
            
                    
                    初始化过程
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1.1" data-path="../../源码/初始化过程/Spring  IOC 容器初始化过程_主要加载步骤.html">
            
                <a href="../../源码/初始化过程/Spring  IOC 容器初始化过程_主要加载步骤.html">
            
                    
                    Spring  IOC 容器初始化过程_主要加载步骤
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.2" data-path="../../源码/初始化过程/springSourceCode_analysis_00_main_00001.html">
            
                <a href="../../源码/初始化过程/springSourceCode_analysis_00_main_00001.html">
            
                    
                    Spring#loadBeanDefinitions(...) 加载 配置文件 主要流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.3" data-path="../../源码/初始化过程/springSourceCode_analysis_00_main_00001.html">
            
                <a href="../../源码/初始化过程/springSourceCode_analysis_00_main_00001.html">
            
                    
                    Spring#getBean() 加载 BeanInstance 主要流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.4" data-path="../../源码/初始化过程/Spring加载Bean的过程.html">
            
                <a href="../../源码/初始化过程/Spring加载Bean的过程.html">
            
                    
                    Spring加载Bean的过程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.5" data-path="../../源码/初始化过程/Spring 加载Bean的过程_getSingleton 实例化单例对象.html">
            
                <a href="../../源码/初始化过程/Spring 加载Bean的过程_getSingleton 实例化单例对象.html">
            
                    
                    Spring 加载Bean的过程_getSingleton 实例化单例对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.1.6" data-path="../../源码/初始化过程/spring getBean_instance BeanWrapper.html">
            
                <a href="../../源码/初始化过程/spring getBean_instance BeanWrapper.html">
            
                    
                    Spring 加载Bean的过程_实例化 BeanWrapper
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" >
            
                <span>
            
                    
                    Aop
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.2.1" data-path="../../源码/Aop/Aop.html">
            
                <a href="../../源码/Aop/Aop.html">
            
                    
                    Aop
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" >
            
                <span>
            
                    
                    Transaction
            
                </span>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../工具方法/spring_core_ResolvableType_2019-06-26.html">
            
                <a href="../../工具方法/spring_core_ResolvableType_2019-06-26.html">
            
                    
                    解析类型工具——ResolvableType
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../工具方法/spring_core_GenericTypeResolver_2019-06-26.html">
            
                <a href="../../工具方法/spring_core_GenericTypeResolver_2019-06-26.html">
            
                    
                    泛型类型解析工具——GenericTypeResolver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../../工具方法/spring_core_TypeDescriptor_2019-07-04.html">
            
                <a href="../../工具方法/spring_core_TypeDescriptor_2019-07-04.html">
            
                    
                    类型描述工具——TypeDescriptor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../../工具方法/spring_core_TypeDescriptor_2020-09-25.html">
            
                <a href="../../工具方法/spring_core_TypeDescriptor_2020-09-25.html">
            
                    
                    类型描述工具——TypeDescriptor2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../../工具方法/spring_core_BridgeMethodResolver_2019-07-08.html">
            
                <a href="../../工具方法/spring_core_BridgeMethodResolver_2019-07-08.html">
            
                    
                    Bridge方法解析工具——BridgeMethodResolver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" >
            
                <span>
            
                    
                    应用
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.1" data-path="../Spel.html">
            
                <a href="../Spel.html">
            
                    
                    SpEL 表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.2" data-path="../Spring_transactional_propagation.html">
            
                <a href="../Spring_transactional_propagation.html">
            
                    
                    Spring事务的传播
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3" data-path="springSourceCode_analysis_1_78368930.html">
            
                <a href="springSourceCode_analysis_1_78368930.html">
            
                    
                    (转)spring源码分析(一)IOC管理Bean
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.4" data-path="springSourceCode_analysis_1_80138425.html">
            
                <a href="springSourceCode_analysis_1_80138425.html">
            
                    
                    (转)Sring源码解析(一)Spring是怎么读取配置Xml文件的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.5" data-path="springSourceCode_analysis_2_80169701.html">
            
                <a href="springSourceCode_analysis_2_80169701.html">
            
                    
                    (转)Spring源码分析(二)Spring怎么扩展解析xml接口的
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.7.6" data-path="springSourceCode_analysis_3_80223871.html">
            
                <a href="springSourceCode_analysis_3_80223871.html">
            
                    
                    (转)Spring源码分析(三)Spring是如何把元素解析成BeanDefinition对象的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.7" data-path="springSourceCode_analysis_4_80226375.html">
            
                <a href="springSourceCode_analysis_4_80226375.html">
            
                    
                    (转)Spring源码解析(四)Spring是怎么处理BeanDefinition的？
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.8" data-path="springSourceCode_analysis_5_80238746.html">
            
                <a href="springSourceCode_analysis_5_80238746.html">
            
                    
                    (转)Spring源码解析(五)Spring 加载bean 依赖注入
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.9" data-path="springSourceCode_analysis_6_80287736.html">
            
                <a href="springSourceCode_analysis_6_80287736.html">
            
                    
                    (转)Spring源码分析(六)FactoryBean 接口解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.10" data-path="springSourceCode_analysis_7_80289441.html">
            
                <a href="springSourceCode_analysis_7_80289441.html">
            
                    
                    (转)Spring源码分析(七)扩展接口BeanPostProcessors源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.11" data-path="springSourceCode_analysis_8_80291728.html">
            
                <a href="springSourceCode_analysis_8_80291728.html">
            
                    
                    (转)Spring源码分析(八)Spring 所有BeanFactoryPostProcessor扩展接口
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.12" data-path="springSourceCode_analysis_9_80299451.html">
            
                <a href="springSourceCode_analysis_9_80299451.html">
            
                    
                    (转)Spring源码分析(九)lazy-init 在Spring中是怎么控制加载的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.13" data-path="springSourceCode_analysis_10_80301135.html">
            
                <a href="springSourceCode_analysis_10_80301135.html">
            
                    
                    (转)Spring源码解析(十)分析一个Spring循环引用失败的问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.14" data-path="springSourceCode_analysis_11_80321854.html">
            
                <a href="springSourceCode_analysis_11_80321854.html">
            
                    
                    (转)Spring源码解析(十一)Spring扩展接口InstantiationAwareBeanPostProcessor解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.15" data-path="springSourceCode_analysis_12_80348253.html">
            
                <a href="springSourceCode_analysis_12_80348253.html">
            
                    
                    (转)Spring源码解析(十二)Spring扩展接口SmartInstantiationAwareBeanPostProcessor解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.16" data-path="springSourceCode_analysis_14_80363793.html">
            
                <a href="springSourceCode_analysis_14_80363793.html">
            
                    
                    (转)Spring源码解析(十四)Spring调用初始化方法initializeBean
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.17" data-path="springSourceCode_analysis_15_80385067.html">
            
                <a href="springSourceCode_analysis_15_80385067.html">
            
                    
                    (转)Spring源码分析(十五)Spring中常用注解使用以及源码分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.18" data-path="springSourceCode_analysis_16_80389286.html">
            
                <a href="springSourceCode_analysis_16_80389286.html">
            
                    
                    (转)Spring源码解析(十六)Spring是如何利用注解管理IOC容器的
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >(转)Spring源码分析(三)Spring是如何把元素解析成BeanDefinition对象的</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x8F6C;spring&#x6E90;&#x7801;&#x5206;&#x6790;&#x4E09;spring&#x662F;&#x5982;&#x4F55;&#x628A;&#x5143;&#x7D20;&#x89E3;&#x6790;&#x6210;beandefinition&#x5BF9;&#x8C61;&#x7684;">(&#x8F6C;)Spring&#x6E90;&#x7801;&#x5206;&#x6790;(&#x4E09;)Spring&#x662F;&#x5982;&#x4F55;&#x628A;&#x5143;&#x7D20;&#x89E3;&#x6790;&#x6210;BeanDefinition&#x5BF9;&#x8C61;&#x7684;</h1>
<p>spring&#x4E2D;&#x89E3;&#x6790;&#x5143;&#x7D20;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5E94;&#x8BE5;&#x5C31;&#x5C5E;&#x4E8E; BeanDefinition&#x4E86;&#xFF1B;&#x8FD9;&#x4E2A;Spring&#x5BB9;&#x5668;&#x4E2D;&#x6700;&#x57FA;&#x672C;&#x7684;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1B;&#x5B83;&#x8BA9;xml&#x6587;&#x4EF6;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x5F52;&#x5C5E;&#x7684;&#x5730;&#x65B9;&#xFF1B;&#x5728;xml&#x4E2D;&#x5B58;&#x5728;&#x7684;&#x914D;&#x7F6E;&#x90FD;&#x80FD;&#x5728;BeanDefinition&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;&#xFF1B;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x6765;&#x770B;&#x770B;BeanDefinition&#x662F;&#x5982;&#x4F55;&#x88AB;&#x521B;&#x5EFA;&#x7684;</p>
<h2 id="1beandefinition">1.BeanDefinition</h2>
<blockquote>
<p>Spring &#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x5185;&#x90E8;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x662F;&#x8F6C;&#x6362;&#x4E3A;&#x5BB9;&#x5668;&#x4E2D;bean&#x5B9E;&#x4F8B;&#x7684;&#x6700;&#x5C0F;&#x63A5;&#x53E3;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86; &#x5C5E;&#x6027;&#x503C;&#x3001;&#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;&#x503C;&#x7B49;&#x7B49;&#xFF1B;</p>
</blockquote>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanDefinition</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AttributeAccessor</span>, <span class="hljs-title">BeanMetadataElement</span> </span>{
    <span class="hljs-comment">/**
     * &#x4F5C;&#x7528;&#x57DF;&#x6807;&#x8BC6;&#x7B26;&#x3002;
     */</span>
    String SCOPE_SINGLETON = ConfigurableBeanFactory.SCOPE_SINGLETON;   <span class="hljs-comment">// singleton&#x4F5C;&#x7528;&#x57DF;</span>
    String SCOPE_PROTOTYPE = ConfigurableBeanFactory.SCOPE_PROTOTYPE;   <span class="hljs-comment">// prototype&#x4F5C;&#x7528;&#x57DF;</span>

    <span class="hljs-comment">/**
     * &#x89D2;&#x8272;&#x63D0;&#x793A;
     */</span>
    <span class="hljs-keyword">int</span> ROLE_APPLICATION = <span class="hljs-number">0</span>;   <span class="hljs-comment">// &#x8868;&#x660E;BeanDefinition&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4E3B;&#x8981;&#x90E8;&#x5206;&#x3002;&#x901A;&#x5E38;&#x5BF9;&#x5E94;&#x4E8E;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7684;Bean</span>
    <span class="hljs-keyword">int</span> ROLE_SUPPORT = <span class="hljs-number">1</span>;   <span class="hljs-comment">// &#x8868;&#x660E;BeanDefinition&#x662F;&#x652F;&#x6301;&#x5927;&#x90E8;&#x5206;&#x914D;&#x7F6E;&#x3002;&#x901A;&#x5E38;&#x662F;&#x5916;&#x90E8;&#x7684;ComponentDefinition</span>
    <span class="hljs-keyword">int</span> ROLE_INFRASTRUCTURE = <span class="hljs-number">2</span>;    <span class="hljs-comment">// &#x8868;&#x660E;BeanDefinition&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x540E;&#x53F0;&#x89D2;&#x8272;&#xFF0C;&#x4E0E;&#x6700;&#x7EC8;&#x7528;&#x6237;&#x65E0;&#x5173;&#x3002;&#x8FD9;&#x4E2A;&#x63D0;&#x793A;&#x662F;&#x5728;&#x6CE8;&#x518C;bean&#x65F6;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x8FD9;&#x4E9B;bean&#x5B8C;&#x5168;&#x662F;&#x7EC4;&#x4EF6;&#x5B9A;&#x4E49;&#x7684;&#x5185;&#x90E8;&#x5DE5;&#x4F5C;&#x7684;&#x4E00;&#x90E8;&#x5206;</span>


    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x8BE5;BeanDefinition&#x7684;&#x7236;Bean&#x7684;&#x540D;&#x79F0;
     */</span>
    <span class="hljs-function">String <span class="hljs-title">getParentName</span><span class="hljs-params">()</span></span>;     
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setParentName</span><span class="hljs-params">(String parentName)</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;Bean&#x7684;&#x7C7B;&#x540D;
     * 
     */</span>
    <span class="hljs-function">String <span class="hljs-title">getBeanClassName</span><span class="hljs-params">()</span></span>;      <span class="hljs-comment">// &#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x662F;&#x8FD0;&#x884C;&#x65F6;&#x771F;&#x6B63;&#x7684;&#x7C7B;&#x540D;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4E00;&#x4E2A;&#x5B50;&#x5B9A;&#x4E49;&#x8986;&#x76D6;/&#x7EE7;&#x627F;&#x7236;&#x7C7B;&#x7684;&#x540D;&#x79F0;&#x3002;</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setBeanClassName</span><span class="hljs-params">(String beanClassName)</span></span>;    <span class="hljs-comment">// &#x6CE8;&#x610F;&#xFF1A;&#x7C7B;&#x540D;&#x53EF;&#x4EE5;&#x5728;bean&#x5DE5;&#x5382;&#x7684;&#x540E;&#x5904;&#x7406;&#x5668;&#x4E2D;&#x8FDB;&#x884C;&#x4FEE;&#x6539;&#xFF0C;&#x901A;&#x5E38;&#x7528;&#x5B83;&#x7684;&#x89E3;&#x6790;&#x53D8;&#x91CF;&#x66FF;&#x6362;&#x539F;&#x6765;&#x7684;&#x7C7B;&#x540D;</span>

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x5DE5;&#x5382;Bean&#x6216;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#xFF08;&#x5982;&#x679C;&#x6709;&#xFF09;
     */</span>
    <span class="hljs-function">String <span class="hljs-title">getFactoryBeanName</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFactoryBeanName</span><span class="hljs-params">(String factoryBeanName)</span></span>;
    <span class="hljs-function">String <span class="hljs-title">getFactoryMethodName</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFactoryMethodName</span><span class="hljs-params">(String factoryMethodName)</span></span>;    <span class="hljs-comment">// &#x6CE8;&#x610F;&#xFF1A;&#x8BE5;&#x65B9;&#x6CD5;&#x7531;&#x6307;&#x5B9A;&#x5DE5;&#x5382;Bean&#x8C03;&#x7528;&#x6216;&#x8005;&#x4F5C;&#x4E3A;&#x672C;&#x5730;bean&#x7C7B;&#x7684;&#x9759;&#x6001;&#x65B9;&#x6CD5;</span>

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x5F53;&#x524D;Bean&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x6216;&#x8005;&#x4E3A;null&#xFF08;&#x8FD8;&#x4E0D;&#x660E;&#x786E;&#x65F6;&#xFF09;
     */</span>
    <span class="hljs-function">String <span class="hljs-title">getScope</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setScope</span><span class="hljs-params">(String scope)</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x61D2;&#x521D;&#x59CB;&#x5316;
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLazyInit</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setLazyInit</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> lazyInit)</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x8BE5;Bean&#x6240;&#x4F9D;&#x8D56;&#x7684;Bean&#x540D;&#x79F0;&#x5217;&#x8868;
     */</span>
    String[] getDependsOn();
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDependsOn</span><span class="hljs-params">(String... dependsOn)</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x8BE5;Bean&#x662F;&#x5426;&#x4E3A;&#x5176;&#x4ED6;Bean&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x7684;&#x5019;&#x9009;&#x8005;
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> isAutowireCandidate
    <span class="hljs-keyword">void</span> <span class="hljs-title">setAutowireCandidate</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> autowireCandidate)</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x3001;&#x8BBE;&#x7F6E;&#x8BE5;Bean&#x662F;&#x5426;&#x4E3A;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x7684;&#x4E3B;&#x8981;&#x5019;&#x9009;&#x8005;
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrimary</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setPrimary</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> primary)</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x8BE5;Bean&#x7684;&#x6784;&#x9020;&#x5668;&#x53C2;&#x6570;&#x503C;
     */</span>
    <span class="hljs-function">ConstructorArgumentValues <span class="hljs-title">getConstructorArgumentValues</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x8BE5;Bean&#x7684;&#x53EF;&#x8FD0;&#x7528;&#x4E8E;&#x65B0;&#x5B9E;&#x4F8B;&#x7684;&#x5C5E;&#x6027;&#x503C;
     */</span>
    <span class="hljs-function">MutablePropertyValues <span class="hljs-title">getPropertyValues</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * &#x5224;&#x65AD;&#x8BE5;Bean&#x662F;&#x5426;&#x4E3A;&#x5355;&#x4F8B;&#x3001;&#x539F;&#x578B;&#x3001;&#x62BD;&#x8C61;Bean
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSingleton</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrototype</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAbstract</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x8BE5;Bean&#x6240;&#x626E;&#x6F14;&#x7684;&#x89D2;&#x8272;&#xFF08;ROLE_APPLICATION&#x3001;ROLE_SUPPORT&#x3001;ROLE_INFRASTRUCTURE&#xFF09;
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRole</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x8BE5;Bean&#x3001;&#x8D44;&#x6E90;&#x7684;&#x53EF;&#x8BFB;&#x6027;&#x63CF;&#x8FF0;
     */</span>
    <span class="hljs-function">String <span class="hljs-title">getDescription</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">String <span class="hljs-title">getResourceDescription</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * &#x83B7;&#x53D6;&#x539F;&#x59CB;&#x7684;BeanDefinition
     */</span>
    <span class="hljs-function">BeanDefinition <span class="hljs-title">getOriginatingBeanDefinition</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<h2 id="2beandefinitionparserdelegate">2.BeanDefinitionParserDelegate</h2>
<blockquote>
<p>BeanDefinitionParserDelegate&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x91CD;&#x8981;&#x7684;&#x7C7B;&#xFF1B;spring&#x5C06;&#x6240;&#x6709;&#x7684;&#x89E3;&#x6790;&#x64CD;&#x4F5C;&#x90FD;&#x59D4;&#x6258;&#x7ED9;&#x4E86;&#x8FD9;&#x4E2A;&#x7C7B;&#xFF1B;&#x6240;&#x6709;&#x6211;&#x4EEC;&#x4ECA;&#x5929;&#x5206;&#x6790; 
BeanDefinition&#x7684;&#x521B;&#x5EFA;&#xFF0C;&#x90FD;&#x662F;&#x5728;&#x8FD9;&#x4E2A;&#x7C7B;&#x91CC;&#x9762;;</p>
</blockquote>
<p>&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x8FDB;&#x4E00;&#x8D77;&#x8FDB;&#x5165;&#x63A2;&#x4E2A;&#x7A76;&#x7ADF;&#x628A;&#xFF1B;&#x521B;&#x5EFA;BeanDefinition&#x7684;&#x5165;&#x53E3;</p>
<h3 id="21parsebeandefinitionelement">2.1.parseBeanDefinitionElement</h3>
<pre><code class="lang-java">    <span class="hljs-comment">/**                     &#x89E3;&#x6790;&#x5143;&#x7D20;
     *1.containingBean &#x8FD8;&#x4E0D;&#x6E05;&#x695A;&#x4F5C;&#x7528;&#xFF0C;&#x56DE;&#x5934;&#x5206;&#x6790; TODO...
     *2.&#x89E3;&#x6790; id&#xFF0C;name&#x5C5E;&#x6027;&#x653E;&#x5165;List&lt;String&gt; aliases&#x4E2D;&#xFF1B;aliases&#x6301;&#x6709;&#x6240;&#x6709;&#x522B;&#x540D;
     *3.&#x68C0;&#x67E5;beanName&#xFF0C;&#x548C;aliases&#x662F;&#x5426;&#x8DDF;&#x4E4B;&#x524D;&#x6709;&#x91CD;&#x590D;&#xFF1B;&#x56E0;&#x4E3A;&#x5F53;&#x524D;&#x7684;&#x5BF9;&#x8C61;BeanDefinitionParserDelegate&#x4E2D;&#x5C5E;&#x6027; Set&lt;String&gt; usedNames &#x4F1A;&#x6301;&#x6709;&#x6240;&#x6709;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x7684;beanName &#x548C; aliases&#xFF1B;
     *4.&#x89E3;&#x6790;&#x5143;&#x7D20;&#xFF0C;&#x5C06;xml&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#x89E3;&#x6790;&#x6210;AbstractBeanDefinition&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;&#xFF1B;
     *5.&#x89E3;&#x6790;&#x5B8C;&#x4E86;&#x62FF;&#x5230;AbstractBeanDefinition&#x7684;&#x5B9E;&#x4F8B;&#x4E4B;&#x540E;&#xFF1B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;BeanDefinitionHolder&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF1B;
        &#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x6301;&#x6709; AbstractBeanDefinition&#xFF0C;beanName&#xFF0C;aliases&#xFF1B;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#xFF1B;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;holder&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF1B;
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> BeanDefinitionHolder <span class="hljs-title">parseBeanDefinitionElement</span><span class="hljs-params">(Element ele, BeanDefinition containingBean)</span> </span>{
        <span class="hljs-comment">//&#x83B7;&#x53D6;id</span>
        String id = ele.getAttribute(ID_ATTRIBUTE);
        <span class="hljs-comment">//&#x83B7;&#x53D6;name&#x5C5E;&#x6027;&#xFF1B;&#x4F8B;&#x5982;&#xFF1A;&lt;bean id=&quot;simpleProducer&quot; name=&quot;aliases1,;aliases2,;aliases3&quot; &gt; &#x8FD9;&#x6837;&#x5C31;&#x8BBE;&#x7F6E;&#x4E86;&#x591A;&#x4E2A;&#x522B;&#x540D;&#x4E86;</span>
        String nameAttr = ele.getAttribute(NAME_ATTRIBUTE);
        List&lt;String&gt; aliases = <span class="hljs-keyword">new</span> ArrayList&lt;String&gt;();
        <span class="hljs-keyword">if</span> (StringUtils.hasLength(nameAttr)) {
        <span class="hljs-comment">//&#x89E3;&#x6790;&#x522B;&#x540D;&#xFF1B;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x5C31;&#x89E3;&#x6790;&#x6210;&#x4E86;  &#x4E09;&#x4E2A;&#x522B;&#x540D;&#x4E86;aliases1,;aliases2,;aliases3</span>
            String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, MULTI_VALUE_ATTRIBUTE_DELIMITERS);
            aliases.addAll(Arrays.asList(nameArr));
        }

        String beanName = id;
        <span class="hljs-comment">//&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;id&#xFF0C;&#x4F46;&#x662F;&#x8BBE;&#x7F6E;&#x4E86;name &#xFF1B;&#x90A3;&#x4E48;&#x5C31;&#x628A;name&#x522B;&#x540D;&#x4E2D;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5F53;&#x505A; bean&#x7684;&#x540D;&#x5B57;&#xFF1B;&#x5E76;&#x4E14;&#x4ECE;&#x522B;&#x540D;&#x4E2D;remove&#x6389;</span>
        <span class="hljs-keyword">if</span> (!StringUtils.hasText(beanName) &amp;&amp; !aliases.isEmpty()) {
            beanName = aliases.remove(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) {
                logger.debug(<span class="hljs-string">&quot;No XML &apos;id&apos; specified - using &apos;&quot;</span> + beanName +
                        <span class="hljs-string">&quot;&apos; as bean name and &quot;</span> + aliases + <span class="hljs-string">&quot; as aliases&quot;</span>);
            }
        }

        <span class="hljs-keyword">if</span> (containingBean == <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">/**
            *&#x68C0;&#x67E5;&#x5F53;&#x524D;&#x7684;beanName&#x662F;&#x5426;&#x552F;&#x4E00;
            *1.&#x5148;&#x5224;&#x65AD;this.usedNames &#x662F;&#x5426;&#x5305;&#x542B;beanName(this.usedNames&#x662F;&#x4E00;&#x4E2A; set&#x96C6;&#x5408;&#xFF0C;&#x4E13;&#x95E8;&#x4FDD;&#x5B58;&#x6240;&#x6709;&#x7684;beanName)
            *2.&#x5982;&#x679C;this.usedNames&#x4E0D;&#x5305;&#x542B;&#xFF0C;&#x518D;&#x5224;&#x65AD;&#x5F53;&#x524D;aliase&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x88AB;set&#x5230;this.usedNames&#x96C6;&#x5408;&#x4E2D;&#x4E86;;
            *3.&#x5982;&#x679C;&#x4E0A;&#x8FF0;beanName&#x6216;&#x8005;aliase&#x4E2D;&#x88AB;&#x53D1;&#x73B0;&#x5DF2;&#x6CE8;&#x518C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x5426;&#x5219;&#x5C06;beanName&#x548C;aliase&#x4E00;&#x8D77;add&#x5230;this.usedNames&#x4E2D;&#x53BB;
            *4.&#x5C31;&#x7B97;beanName&#x4E0E;&#x522B;&#x540D;aliase&#x6709;&#x91CD;&#x590D;&#x4E5F;&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#xFF0C;set&#x4F1A;&#x81EA;&#x52A8;&#x53BB;&#x91CD;
            */</span>
            checkNameUniqueness(beanName, aliases, ele);
        }
        <span class="hljs-comment">/**
        *1.&#x89E3;&#x6790;Element&#xFF0C;&#x8FD4;&#x56DE;&#x89E3;&#x6790;&#x540E;&#x7684;&#x5BF9;&#x8C61; AbstractBeanDefinition&#xFF1B;&#x5F88;&#x591A;&#x5C5E;&#x6027;&#x4F8B;&#x5982;&#xFF1A;class&#x3001;parent&#x3001;scope&#x3001;abstract&#x3001;lazy-init&#x3001;meta&#x3001;lookup-method&#x3001;replaced-method&#x3001;constructor-arg&#x3001;property&#x3001;qualifier&#x7B49;&#xFF1B;
        *2.&#x8FD9;&#x4E2A;beanName&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x53EA;&#x662F;&#x7528;&#x4F5C; &#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x8BB0;&#x5F55;
        *3.&#x770B;&#x4E0B;&#x6587;&#x8BE6;&#x7EC6;
        */</span>
        AbstractBeanDefinition beanDefinition = parseBeanDefinitionElement(ele, beanName, containingBean);
        <span class="hljs-keyword">if</span> (beanDefinition != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">//&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E; id &#x4E5F;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;name&#x5C5E;&#x6027;&#xFF1B;&#x5219;spring&#x751F;&#x6210;&#x4E00;&#x4E2A;beanName</span>
            <span class="hljs-keyword">if</span> (!StringUtils.hasText(beanName)) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">//TODO... &#x8FD9;&#x4E2A;containingBean&#x8FD8;&#x4E0D;&#x77E5;&#x9053;&#x662F;&#x5E72;&#x5565;&#x7528;&#x7684;</span>
                    <span class="hljs-keyword">if</span> (containingBean != <span class="hljs-keyword">null</span>) {
                        <span class="hljs-comment">//&#x81EA;&#x52A8;&#x751F;&#x6210;beanName;&#x751F;&#x6210;&#x89C4;&#x5219;&#x6211;&#x5C31;&#x4E0D;&#x8D58;&#x8FF0;&#x4E86;</span>
                        beanName = BeanDefinitionReaderUtils.generateBeanName(
                                beanDefinition, <span class="hljs-keyword">this</span>.readerContext.getRegistry(), <span class="hljs-keyword">true</span>);
                    }
                    <span class="hljs-keyword">else</span> {
                        beanName = <span class="hljs-keyword">this</span>.readerContext.generateBeanName(beanDefinition);
                        <span class="hljs-comment">// Register an alias for the plain bean class name, if still possible,</span>
                        <span class="hljs-comment">// if the generator returned the class name plus a suffix.</span>
                        <span class="hljs-comment">// This is expected for Spring 1.2/2.0 backwards compatibility.</span>
                        String beanClassName = beanDefinition.getBeanClassName();
                        <span class="hljs-keyword">if</span> (beanClassName != <span class="hljs-keyword">null</span> &amp;&amp;
                                beanName.startsWith(beanClassName) &amp;&amp; beanName.length() &gt; beanClassName.length() &amp;&amp;
                                !<span class="hljs-keyword">this</span>.readerContext.getRegistry().isBeanNameInUse(beanClassName)) {
                            aliases.add(beanClassName);
                        }
                    }
                    <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) {
                        logger.debug(<span class="hljs-string">&quot;Neither XML &apos;id&apos; nor &apos;name&apos; specified - &quot;</span> +
                                <span class="hljs-string">&quot;using generated bean name [&quot;</span> + beanName + <span class="hljs-string">&quot;]&quot;</span>);
                    }
                }
                <span class="hljs-keyword">catch</span> (Exception ex) {
                    error(ex.getMessage(), ele);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
                }
            }
            String[] aliasesArray = StringUtils.toStringArray(aliases);
            <span class="hljs-comment">//</span>
            <span class="hljs-comment">/**
            *1.&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;BeanDefinitionHolder&#x5BF9;&#x8C61;&#xFF0C;&#x7EE7;&#x627F;&#x5B50; implements BeanMetadataElement &#xFF1B;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x6301;&#x6709;
            *   this.beanDefinition = beanDefinition;
                this.beanName = beanName;
                this.aliases = aliases;
            */</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BeanDefinitionHolder(beanDefinition, beanName, aliasesArray);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
</code></pre>
<h3 id="22parsebeandefinitionelement">2.2.parseBeanDefinitionElement</h3>
<pre><code class="lang-java">    <span class="hljs-comment">/**
     * &#x89E3;&#x6790;bean definition ,&#x4E0D;&#x5305;&#x62EC;&#x540D;&#x79F0;&#x6216;&#x522B;&#x540D;(&#x56E0;&#x4E3A;&#x4E0A;&#x9762;&#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x8FC7;&#x540D;&#x79F0;&#x548C;&#x522B;&#x540D;&#x4E86;),&#x5F53;&#x89E3;&#x6790;&#x5F02;&#x5E38;&#x7684;&#x65F6;&#x5019;&#x56DE;&#x8FD4;&#x56DE;null&#xFF1B;
     * &#x8FD4;&#x56DE;&#x7684;&#x662F;&#x4E00;&#x4E2A;GenericBeanDefinition&#x5BF9;&#x8C61;
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AbstractBeanDefinition <span class="hljs-title">parseBeanDefinitionElement</span><span class="hljs-params">(
            Element ele, String beanName, BeanDefinition containingBean)</span> </span>{
        <span class="hljs-comment">/**
        * 1.BeanEntry&#x662F;&#x4E00;&#x4E2A; bean&#x7684;&#x5B9E;&#x4F53;&#x7C7B;&#xFF0C;&#x5B83;implements&#x4E86; ParseState.Entry&#x63A5;&#x53E3;&#xFF1B;Entry&#x662F;&#x4E00;&#x4E2A;&#x6807;&#x5FD7;&#x63A5;&#x53E3;&#xFF0C;&#x4EC0;&#x4E48;&#x90FD;&#x6CA1;&#x6709;&#x505A;&#xFF1B;
        * BeanEntry &#x53EA;&#x6709;&#x4E00;&#x4E2A;private String beanDefinitionName;&#x5C5E;&#x6027;
        * 2.ParseState&#x7C7B;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;private final Stack&lt;Entry&gt; state;&#x6808;&#xFF1B;&#x5B58;&#x653E;&#x7684;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x662F; Entry
        * 3.ParseState&#x7B80;&#x5355;&#x7684;&#x6808;&#x7ED3;&#x6784;&#x6765;&#x8DDF;&#x8E2A;&#x903B;&#x8F91;&#x4F4D;&#x7F6E;&#x4E2D;&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x8BB0;&#x5F55;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#xFF1B;&#x5728;&#x5F02;&#x5E38;&#x7684;&#x65F6;&#x5019; Spring&#x8C03;&#x7528;error&#x65B9;&#x6CD5;&#xFF0C;&#x4F1A;&#x628A;ParseState&#x6808;&#x4E2D;&#x7684;&#x4FE1;&#x606F;&#x4E00;&#x8D77;&#x629B;&#x51FA;
        */</span>
        <span class="hljs-keyword">this</span>.parseState.push(<span class="hljs-keyword">new</span> BeanEntry(beanName));
        <span class="hljs-comment">//&#x83B7;&#x53D6;element&#x4E2D;&#x6709; class&#x5C5E;&#x6027;&#xFF1B;</span>
        String className = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (ele.hasAttribute(CLASS_ATTRIBUTE)) {
            className = ele.getAttribute(CLASS_ATTRIBUTE).trim();
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//&#x83B7;&#x53D6;parent&#x5C5E;&#x6027;</span>
            String parent = <span class="hljs-keyword">null</span>;
            <span class="hljs-keyword">if</span> (ele.hasAttribute(PARENT_ATTRIBUTE)) {
                parent = ele.getAttribute(PARENT_ATTRIBUTE);
            }
            <span class="hljs-comment">/**
            *1.AbstractBeanDefinition extends BeanMetadataAttributeAccessor
        implements BeanDefinition, Cloneable ;&#x5B83;&#x5B9E;&#x73B0;&#x4E86;&#x90E8;&#x5206;BeanDefinition&#xFF1B;
            *2.&#x5B9E;&#x73B0;&#x4E0A;&#x521B;&#x5EFA;&#x7684;&#x662F;&#x4E00;&#x4E2A;GenericBeanDefinition&#x5BF9;&#x8C61;&#xFF1B;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7EE7;&#x627F;&#x4E86;AbstractBeanDefinition&#xFF1B;&#x5E76;&#x4E14;&#x65B0;&#x589E;&#x4E86;&#x5C5E;&#x6027;private String parentName;&#x8FD8;&#x5B9E;&#x73B0;&#x4E86;cloneBeanDefinition()&#x7B49;&#x65B9;&#x6CD5;
            *3.&#x7236;&#x7C7B;&#x7C7B;&#x540D;&#x8DEF;&#x5F84;&#xFF0C;&#x81EA;&#x8EAB;&#x5168;&#x7C7B;&#x540D;&#x8DEF;&#x5F84;,&#x548C;&#x5F53;&#x524D;XmlReaderContext&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x4E3A;&#x53C2;&#x6570;&#x521B;&#x5EFA; AbstractBeanDefinition
                return BeanDefinitionReaderUtils.createBeanDefinition(
                parentName, className, this.readerContext.getBeanClassLoader())&#xFF1B;
            *4.&#x5982;&#x679C;ClassLoader&#x4E3A;null&#xFF1B;&#x5219; bd.setBeanClassName(className);&#x8BBE;&#x7F6E;&#x5168;&#x7C7B;&#x540D;&#x8DEF;&#x5F84;&#xFF1B;
            *  &#x5982;&#x679C;&#x4E0D;&#x4E3A;null&#xFF1B;&#x5219;bd.setBeanClass(ClassUtils.forName(className, classLoader));&#x76F4;&#x63A5;&#x5229;&#x7528;&#x53CD;&#x5C04;&#x5F97;&#x5230;&#x7C7B;&#x7684;Class&#x7C7B;&#x578B;;&#x6700;&#x79CD;&#x8C03;&#x7528;&#x7684;&#x662F; ClassLoader.loadClass(name)
            */</span>
            AbstractBeanDefinition bd = createBeanDefinition(className, parent);
            <span class="hljs-comment">/**
            *1.&#x89E3;&#x6790; &lt;bean &gt;&#x91CC;&#x9762;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x503C;&#xFF1B;&#x4F8B;&#x5982;:scope,abstract,lazy-init,autowire,primary,depends-on&#x7B49;
            *2.&#x6240;&#x6709;&#x7684;&#x5C5E;&#x6027;&#x90FD;&#x8BBE;&#x7F6E;&#x5230;&#x4E86; AbstractBeanDefinition bd&#x4E2D;
            */</span>
            parseBeanDefinitionAttributes(ele, beanName, containingBean, bd);
            <span class="hljs-comment">//&#x8BBE;&#x7F6E;description&#x503C;&#xFF1B;&#x4F8B;&#x5982;&lt;description&gt;test&lt;/description&gt;</span>
            bd.setDescription(DomUtils.getChildElementValueByTagName(ele, DESCRIPTION_ELEMENT));
            <span class="hljs-comment">/**
            *1.&#x89E3;&#x6790;&#x5143;&#x6570;&#x636E; Meta&#xFF1B; Meta&#x5728;Element&#x4E2D;&#x662F; &lt;meta key=&quot;test&quot; value=&quot;testvalue&quot; &gt;&lt;/meta&gt;
            *2.&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x662F; BeanMetadataAttributeAccessor&#xFF1B;bd&#x662F;&#x6709;&#x7EE7;&#x627F;BeanMetadataAttributeAccessor&#x7684;&#xFF1B;
            *3.&#x89E3;&#x6790;&#x4E86;meta&#x4E2D;&#x7684;key&#x548C;value&#xFF1B;&#x653E;&#x5165;&#x5230;BeanMetadataAttribute attribute = new BeanMetadataAttribute(key, value);&#x7136;&#x540E;bd&#x8C03;&#x7528;attributeAccessor.addMetadataAttribute(attribute);&#x5C31;&#x4E0D;meta&#x5143;&#x6570;&#x636E;&#x653E;&#x5165;&#x5230;bd&#x4E2D;&#x53BB;&#x4E86;&#xFF1B;
            */</span>
            parseMetaElements(ele, bd);
            <span class="hljs-comment">/**
            *&#x91CD;&#x5199;&#x7279;&#x5B9A;&#x7684;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE; &#x6307;&#x5B9A; &#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;
            *1.Spring&#x6709;&#x4E00;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x53EF;&#x4EE5;&#x52A8;&#x6001;&#x7684;&#x5B9E;&#x73B0;&#x6216;&#x91CD;&#x5199;bean&#x5BB9;&#x5668;&#x4E2D;&#x6307;&#x5B9A;bean&#x7684;&#x6307;&#x5B9A;&#x65B9;&#x6CD5;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x8FD4;&#x56DE;&#x503C;&#x6307;&#x5B9A;&#x4E3A;bean&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x53E6;&#x4E00;&#x4E2A;bean
            *2.&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019; 
                &lt;bean id=&quot;beanB&quot; class=&quot;com.app.BeanB&quot; scope=&quot;prototype&quot;/&gt;
                    &lt;bean id=&quot;beanA&quot; class=&quot;com.app.BeanA&quot;&gt;
                    &lt;!-- &#x8868;&#x793A;&#x5C06;&#x7531;Spring&#x91CD;&#x5199;getBeanB()&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x540D;&#x4E3A;beanB&#x7684;bean --&gt;
                    &lt;lookup-method name=&quot;getBeanB&quot; bean=&quot;beanB&quot;/&gt;
                &lt;/bean&gt;
            *3.bd&#x4E2D;&#x7684;&#x5C5E;&#x6027;private MethodOverrides methodOverrides = new MethodOverrides();&#x4E13;&#x95E8;&#x5B58;&#x653E;&#x8FD9;&#x4E2A;
            *4.&#x89E3;&#x6790;&#x5230;bd&#x4E2D; 
                LookupOverride override = new LookupOverride(methodName, beanRef);
                override.setSource(extractSource(ele));
                overrides.addOverride(override);

            *5.&#x8BE6;&#x7EC6;&#xFF1A;[&#x8FD9;&#x91CC;&#x5199;&#x94FE;&#x63A5;&#x5185;&#x5BB9;](https://blog.csdn.net/elim168/article/details/74939012)
            */</span>
            parseLookupOverrideSubElements(ele, bd.getMethodOverrides());
            <span class="hljs-comment">/**
            *1.&#x8DDF;&#x4E0A;&#x9762;&#x7C7B;&#x4F3C;
            *2.replaced method&#x6CE8;&#x5165;&#x662F;spring&#x52A8;&#x6001;&#x6539;&#x53D8;bean&#x91CC;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x9700;&#x8981;&#x6539;&#x53D8;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528;spring&#x5185;&#x539F;&#x6709;&#x5176;&#x4ED6;&#x7C7B;&#xFF08;&#x9700;&#x8981;&#x7EE7;&#x627F;&#x63A5;&#x53E3;org.springframework.beans.factory.support.MethodReplacer&#xFF09;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x66FF;&#x6362;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x3002;&#x901A;&#x8FC7;&#x6539;&#x53D8;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x903B;&#x8F91;&#x6765;&#x52A8;&#x6001;&#x6539;&#x53D8;&#x65B9;&#x6CD5;&#x3002;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E3A;&#x4F7F;&#x7528;cglib&#x65B9;&#x6CD5;&#xFF0C;&#x91CD;&#x65B0;&#x751F;&#x6210;&#x5B50;&#x7C7B;&#xFF0C;&#x91CD;&#x5199;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#xFF0C;&#x8FBE;&#x5230;&#x52A8;&#x6001;&#x6539;&#x53D8;&#x7684;&#x6548;&#x679C;&#x3002;
            3.ReplaceOverride replaceOverride = new ReplaceOverride(name, callback);
                // Look for arg-type match elements.
                List&lt;Element&gt; argTypeEles = DomUtils.getChildElementsByTagName(replacedMethodEle, ARG_TYPE_ELEMENT);
                for (Element argTypeEle : argTypeEles) {
                    String match = argTypeEle.getAttribute(ARG_TYPE_MATCH_ATTRIBUTE);
                    match = (StringUtils.hasText(match) ? match : DomUtils.getTextValue(argTypeEle));
                    if (StringUtils.hasText(match)) {
                        replaceOverride.addTypeIdentifier(match);
                    }
                }
                replaceOverride.setSource(extractSource(replacedMethodEle));
                overrides.addOverride(replaceOverride);

            */</span>
            parseReplacedMethodSubElements(ele, bd.getMethodOverrides());
            <span class="hljs-comment">//</span>
            <span class="hljs-comment">/**
            *1.&#x89E3;&#x6790;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x7684;&#x53C2;&#x6570; constructor-arg&#xFF1B;&#x653E;&#x5165;bd&#x4E2D;&#x7684; ConstructorArgumentValues constructorArgumentValues&#x5C5E;&#x6027;&#x4E2D;Map&lt;Integer, ValueHolder&gt; indexedArgumentValues map&#x4E2D;;
            *2.&#x89E3;&#x6790;&#x7684;&#x662F; &lt;constructor-arg index=&quot;0&quot; value=&quot;1&quot; /&gt;&#x8FD9;&#x79CD;&#x7684;
            */</span>
            parseConstructorArgElements(ele, bd);
            <span class="hljs-comment">/**
            *1.set&#x65B9;&#x6CD5;&#x6CE8;&#x5165;&#x7684;&#x5904;&#x7406;(&#x6BD4;&#x8F83;&#x5E38;&#x7528;&#x7684;&#x6CE8;&#x5165;)&#xFF1B;&#x683C;&#x5F0F;&#x662F;&lt;property name=&quot;application&quot; value=&quot;${myApplicationCode}&quot;/&gt;
            *2.&#x4E0E;&#x4E0A;&#x9762;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x662F;&#xFF1B;&#x8FD9;&#x91CC;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x7684;&#x503C;&#x662F;&#x4E2A;PropertyValue&#x5BF9;&#x8C61;
            *3.show the code
                //&#x89E3;&#x6790;&#x51FA;&#x6765;&#x5C5E;&#x6027;&#x503C;
                Object val = parsePropertyValue(ele, bd, propertyName);
                //&#x6784;&#x9020;PropertyValue&#x5B9E;&#x4F8B;
                PropertyValue pv = new PropertyValue(propertyName, val);
                //&#x89E3;&#x6790;&#x5143;&#x6570;&#x636E; meta&#x6570;&#x636E; &#xFF1B;&#x5C5E;&#x6027;&#x4E0B;&#x4E5F;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;meta
                ![meta](https://img-blog.csdn.net/20180507143039501?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTA2MzQwNjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
                parseMetaElements(ele, pv);
                pv.setSource(extractSource(ele));
                //&#x5C06;PropertyValue&#x8BBE;&#x7F6E;&#x5230;bd&#x7684;MutablePropertyValues propertyValues;&#x5C5E;&#x6027;&#x4E2D;&#xFF1B;
                bd.getPropertyValues().addPropertyValue(pv);
            */</span>
            parsePropertyElements(ele, bd);
            <span class="hljs-comment">/**
            *1.&#x89E3;&#x6790;qualifier&#x5143;&#x7D20;&#xFF1B;&#x5B58;&#x653E;&#x5728; Map&lt;String, AutowireCandidateQualifier&gt; qualifiers
            */</span>
            parseQualifierElements(ele, bd);

            bd.setResource(<span class="hljs-keyword">this</span>.readerContext.getResource());
            bd.setSource(extractSource(ele));

            <span class="hljs-keyword">return</span> bd;
        }
        <span class="hljs-keyword">catch</span> (ClassNotFoundException ex) {
            error(<span class="hljs-string">&quot;Bean class [&quot;</span> + className + <span class="hljs-string">&quot;] not found&quot;</span>, ele, ex);
        }
        <span class="hljs-keyword">catch</span> (NoClassDefFoundError err) {
            error(<span class="hljs-string">&quot;Class that bean class [&quot;</span> + className + <span class="hljs-string">&quot;] depends on not found&quot;</span>, ele, err);
        }
        <span class="hljs-keyword">catch</span> (Throwable ex) {
            error(<span class="hljs-string">&quot;Unexpected failure during bean definition parsing&quot;</span>, ele, ex);
        }
        <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">this</span>.parseState.pop();
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
</code></pre>
<h3 id="23-parsebeandefinitionattributes">2.3 parseBeanDefinitionAttributes</h3>
<pre><code class="lang-java">     <span class="hljs-comment">//&#x89E3;&#x6790;bean&#x7684;&#x5C5E;&#x6027;&#x503C;</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> AbstractBeanDefinition <span class="hljs-title">parseBeanDefinitionAttributes</span><span class="hljs-params">(Element ele, String beanName,
            BeanDefinition containingBean, AbstractBeanDefinition bd)</span> </span>{
        <span class="hljs-comment">/**singleton &#x5C5E;&#x6027;&#x662F;1.x&#x7684;&#x65F6;&#x5019;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x73B0;&#x5728;&#x5DF2;&#x7ECF;&#x5E9F;&#x5F03;&#xFF0C;&#x7528;scope&#x4EE3;&#x66FF;&#x4E86;;&#x4F8B;&#x5982; scope=&quot;singleton&quot;**/</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(SINGLETON_ATTRIBUTE)) {
            error(<span class="hljs-string">&quot;Old 1.x &apos;singleton&apos; attribute in use - upgrade to &apos;scope&apos; declaration&quot;</span>, ele);
        }
        <span class="hljs-comment">/**
        *&#x8BBE;&#x7F6E;&#x4F5C;&#x7528;&#x57DF;&#xFF1B;private String scope = SCOPE_DEFAULT;&#x662F;AbstractBeanDefinition&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; &quot;&quot; ;
        */</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ele.hasAttribute(SCOPE_ATTRIBUTE)) {
            bd.setScope(ele.getAttribute(SCOPE_ATTRIBUTE));
        }
        <span class="hljs-comment">/** &#x8FD9;&#x4E2A;containingBean &#x6682;&#x65F6;&#x4E0D;&#x6E05;&#x695A;&#x4F5C;&#x7528;&#xFF0C;&#x7B49;&#x4F1A;&#x5206;&#x6790; TODO.. **/</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (containingBean != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// Take default from containing bean in case of an inner bean definition.</span>
            bd.setScope(containingBean.getScope());
        }
        <span class="hljs-comment">//&#x8BBE;&#x7F6E; abstract&#x5C5E;&#x6027;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F; false</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(ABSTRACT_ATTRIBUTE)) {
            bd.setAbstract(TRUE_VALUE.equals(ele.getAttribute(ABSTRACT_ATTRIBUTE)));
        }
        <span class="hljs-comment">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x5143;&#x7D20;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E; lazyInit &#x61D2;&#x52A0;&#x8F7D;&#xFF1B;&#x5219;&#x53BB; this.defaults.getLazyInit()&#xFF1B;&#x8FD9;&#x4E2A;defaults&#x662F;&#x4E0A;&#x4E00;&#x7BC7;&#x5206;&#x6790;&#x8FC7;&#x7684;&#xFF1B;&#x6574;&#x4E2A;xml&#x6587;&#x4EF6;&#x5168;&#x5C40;&#x7684;&#x9ED8;&#x8BA4;&#x503C;&#xFF1B;</span>
        String lazyInit = ele.getAttribute(LAZY_INIT_ATTRIBUTE);
        <span class="hljs-keyword">if</span> (DEFAULT_VALUE.equals(lazyInit)) {
            lazyInit = <span class="hljs-keyword">this</span>.defaults.getLazyInit();
        }
        bd.setLazyInit(TRUE_VALUE.equals(lazyInit));
        <span class="hljs-comment">// &#x8BBE;&#x7F6E;&#x6CE8;&#x5165;&#x65B9;&#x5F0F;&#xFF0C;&#x6709; byName byType &#x7B49;&#x7B49;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x53D6;this.defaults.getAutowire()&#x7684;&#x503C;&#xFF1B;</span>
        <span class="hljs-comment">//&#x7136;&#x540E;&#x5C06;&#x5176;&#x8F6C;&#x6362;&#x4E3A;&#x5BF9;&#x5E94;&#x7684;int&#x7C7B;&#x578B;&#xFF1B;&#x4F8B;&#x5982;byName&#x662F;int AUTOWIRE_BY_NAME = 1;</span>
        String autowire = ele.getAttribute(AUTOWIRE_ATTRIBUTE);
        bd.setAutowireMode(getAutowireMode(autowire));
        <span class="hljs-comment">//&#x8FD9;&#x4E2A;dependency-check&#x5B57;&#x9762;&#x610F;&#x4E49;&#x662F;&#x4F9D;&#x8D56;&#x68C0;&#x67E5;&#x7684;&#x7C7B;&#x578B;&#xFF1B;&#x5177;&#x4F53;&#x4E00;&#x4F1A;&#x5206;&#x6790;&#xFF1B;&#x5982;&#x679C;&#x5F53;&#x524D;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF0C;&#x5219;&#x53D6;this.defaults.getDependencyCheck()&#x7684;&#x503C;&#xFF1B;TODO...</span>
        String dependencyCheck = ele.getAttribute(DEPENDENCY_CHECK_ATTRIBUTE);
        bd.setDependencyCheck(getDependencyCheck(dependencyCheck));
        <span class="hljs-comment">/**
        * 1.&#x8BBE;&#x7F6E;depends-on&#x5C5E;&#x6027;&#xFF1B;
        * 2.depends-on=&quot;commonService,;redisComponent&quot;&#x53EF;&#x4EE5;&#x7528; &#xFF0C;&#xFF1B;&#x6765;&#x8BBE;&#x7F6E;&#x591A;&#x4E2A;&#xFF1B;&#x6240;&#x4EE5;AbstractBeanDefinition&#x4E2D;&#x7684;dependsOn&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#x7C7B;&#x578B;
        * 3.depends-on&#x662F;&#x6307;&#x6307;&#x5B9A;Bean&#x521D;&#x59CB;&#x5316;&#x53CA;&#x9500;&#x6BC1;&#x65F6;&#x7684;&#x987A;&#x5E8F;&#xFF0C;&#x4F7F;&#x7528;depends-on&#x5C5E;&#x6027;&#x6307;&#x5B9A;&#x7684;Bean&#x8981;&#x5148;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6BD5;&#x540E;&#x624D;&#x521D;&#x59CB;&#x5316;&#x5F53;&#x524D;Bean
        */</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(DEPENDS_ON_ATTRIBUTE)) {
            String dependsOn = ele.getAttribute(DEPENDS_ON_ATTRIBUTE);
            bd.setDependsOn(StringUtils.tokenizeToStringArray(dependsOn, MULTI_VALUE_ATTRIBUTE_DELIMITERS));
        }
        <span class="hljs-comment">//&#x8FD9;&#x4E2A;autowireCandidate&#x4E0D;&#x662F;&#x5F88;&#x6E05;&#x695A;  &#x56DE;&#x5934;&#x5206;&#x6790;TODo..</span>
        String autowireCandidate = ele.getAttribute(AUTOWIRE_CANDIDATE_ATTRIBUTE);
        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;&quot;</span>.equals(autowireCandidate) || DEFAULT_VALUE.equals(autowireCandidate)) {
            String candidatePattern = <span class="hljs-keyword">this</span>.defaults.getAutowireCandidates();
            <span class="hljs-keyword">if</span> (candidatePattern != <span class="hljs-keyword">null</span>) {
                String[] patterns = StringUtils.commaDelimitedListToStringArray(candidatePattern);
                bd.setAutowireCandidate(PatternMatchUtils.simpleMatch(patterns, beanName));
            }
        }
        <span class="hljs-keyword">else</span> {
            bd.setAutowireCandidate(TRUE_VALUE.equals(autowireCandidate));
        }
        <span class="hljs-comment">//&#x8BBE;&#x7F6E;primary &#x88C5;&#x914D;&#x65F6;&#x5F53;&#x51FA;&#x73B0;&#x591A;&#x4E2A;Bean&#x5019;&#x9009;&#x8005;&#x65F6;&#xFF0C;&#x88AB;&#x6807;&#x8BB0;&#x4E3A;Primary&#x7684;Bean&#x5C06;&#x4F5C;&#x4E3A;&#x9996;&#x9009;&#x8005;&#xFF0C;&#x5426;&#x5219;&#x5C06;&#x629B;&#x51FA;&#x5F02;&#x5E38; &#xFF1B;&#x9ED8;&#x8BA4;&#x4E3A;false</span>
        <span class="hljs-comment">//https://blog.csdn.net/qq_16055765/article/details/78833260</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(PRIMARY_ATTRIBUTE)) {
            bd.setPrimary(TRUE_VALUE.equals(ele.getAttribute(PRIMARY_ATTRIBUTE)));
        }
        <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x521D;&#x59CB;&#x5316;&#x65B9;&#x6CD5;</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(INIT_METHOD_ATTRIBUTE)) {
            String initMethodName = ele.getAttribute(INIT_METHOD_ATTRIBUTE);
            <span class="hljs-keyword">if</span> (!<span class="hljs-string">&quot;&quot;</span>.equals(initMethodName)) {
                bd.setInitMethodName(initMethodName);
            }
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//&#x5982;&#x679C; &#x5F53;&#x524D;&#x5143;&#x7D20;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E; init_method &#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x5224;&#x65AD; xml&#x5168;&#x5C40;&#x914D;&#x7F6E;&#x6709;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;&#xFF1B;this.defaults&#x662F;&#x5168;&#x5C40;&#x8BBE;&#x7F6E;</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.defaults.getInitMethod() != <span class="hljs-keyword">null</span>) {
                bd.setInitMethodName(<span class="hljs-keyword">this</span>.defaults.getInitMethod());
                bd.setEnforceInitMethod(<span class="hljs-keyword">false</span>);
            }
        }
        <span class="hljs-comment">//&#x4E0E;&#x4E0A;&#x9762;&#x521D;&#x59CB;&#x5316;&#x65E0;&#x4E8C;</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(DESTROY_METHOD_ATTRIBUTE)) {
            String destroyMethodName = ele.getAttribute(DESTROY_METHOD_ATTRIBUTE);
            bd.setDestroyMethodName(destroyMethodName);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.defaults.getDestroyMethod() != <span class="hljs-keyword">null</span>) {
                bd.setDestroyMethodName(<span class="hljs-keyword">this</span>.defaults.getDestroyMethod());
                bd.setEnforceDestroyMethod(<span class="hljs-keyword">false</span>);
            }
        }
        <span class="hljs-comment">//&#x8BBE;&#x7F6E;factoryMethodName&#xFF1B; spring&#x901A;&#x8FC7;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x914D;&#x7F6E;Bean</span>
        <span class="hljs-comment">//https://blog.csdn.net/mrwuyi/article/details/51578654</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(FACTORY_METHOD_ATTRIBUTE)) {
            bd.setFactoryMethodName(ele.getAttribute(FACTORY_METHOD_ATTRIBUTE));
        }
        <span class="hljs-comment">//&#x8BBE;&#x7F6E;factoryBeanName   spring&#x901A;&#x8FC7;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x914D;&#x7F6E;Bean</span>
        <span class="hljs-comment">//https://blog.csdn.net/mrwuyi/article/details/51578654</span>
        <span class="hljs-keyword">if</span> (ele.hasAttribute(FACTORY_BEAN_ATTRIBUTE)) {
            bd.setFactoryBeanName(ele.getAttribute(FACTORY_BEAN_ATTRIBUTE));
        }

        <span class="hljs-keyword">return</span> bd;
    }
</code></pre>
<h3 id="24-parseconstructorargelement">2.4 parseConstructorArgElement</h3>
<pre><code class="lang-java">    <span class="hljs-comment">/**
     * &#x89E3;&#x6790; &#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x53C2;&#x6570;
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parseConstructorArgElement</span><span class="hljs-params">(Element ele, BeanDefinition bd)</span> </span>{
        String indexAttr = ele.getAttribute(INDEX_ATTRIBUTE);
        String typeAttr = ele.getAttribute(TYPE_ATTRIBUTE);
        String nameAttr = ele.getAttribute(NAME_ATTRIBUTE);
        <span class="hljs-comment">//&#x5982;&#x679C;xml&#x914D;&#x7F6E;&#x4E86;index</span>
        <span class="hljs-keyword">if</span> (StringUtils.hasLength(indexAttr)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">int</span> index = Integer.parseInt(indexAttr);
                <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) {
                    error(<span class="hljs-string">&quot;&apos;index&apos; cannot be lower than 0&quot;</span>, ele);
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">/**
                        *1.&#x6784;&#x9020;&#x53C2;&#x6570;&#x5B9E;&#x4F53;&#x7C7B;&#x7EE7;&#x627F;&#x5B50;ParseState.Entry ConstructorArgumentEntry implements ParseState.Entry;&#x6709;&#x4E2A;int index;&#x5C5E;&#x6027;
                        *2.&#x4E0A;&#x9762;&#x89E3;&#x6790;beanName&#x548C;aliaes&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x6709;&#x4E2A;BeanEntry&#x5B9E;&#x4F53;&#x7C7B;&#x7EE7;&#x627F;&#x81EA;ParseState.Entry&#xFF0C;&#x5B83;&#x6709;&#x4E2A;&#x5C5E;&#x6027;&#x662F;beanDefinitionName
                        *3.&#x540C;&#x6837;&#x7684;&#xFF0C;&#x5C06;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;push&#x5230; parseState&#x4E2D;&#x5B58;&#x653E;&#xFF1B;
                        */</span>
                        <span class="hljs-keyword">this</span>.parseState.push(<span class="hljs-keyword">new</span> ConstructorArgumentEntry(index));
                            <span class="hljs-comment">/**
                             * Get the value of a property element. May be a list etc.
                             * Also used for constructor arguments, &quot;propertyName&quot; being null in this case.
                             * &#x83B7;&#x53D6;&#x5C5E;&#x6027;&#x503C;
                             */</span>
                        Object value = parsePropertyValue(ele, bd, <span class="hljs-keyword">null</span>);
                        <span class="hljs-comment">//&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;ValueHolder&#x5B9E;&#x4F8B;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E13;&#x95E8;&#x5B58;&#x653E;&#x6784;&#x9020;&#x53C2;&#x6570;&#x7684;&#x4E00;&#x4E9B; &#x5C5E;&#x6027;&#x503C;&#x7684;</span>
                        ConstructorArgumentValues.ValueHolder valueHolder = <span class="hljs-keyword">new</span> ConstructorArgumentValues.ValueHolder(value);
                        <span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x7C7B;&#x578B;</span>
                        <span class="hljs-keyword">if</span> (StringUtils.hasLength(typeAttr)) {
                            valueHolder.setType(typeAttr);
                        }
                        <span class="hljs-comment">//&#x8BBE;&#x7F6E;name</span>
                        <span class="hljs-keyword">if</span> (StringUtils.hasLength(nameAttr)) {
                            valueHolder.setName(nameAttr);
                        }
                        valueHolder.setSource(extractSource(ele));
                        <span class="hljs-comment">//&#x9A8C;&#x8BC1;index&#x662F;&#x5426;&#x8BBE;&#x7F6E;&#x6B63;&#x786E;</span>
                        <span class="hljs-keyword">if</span> (bd.getConstructorArgumentValues().hasIndexedArgumentValue(index)) {
                            error(<span class="hljs-string">&quot;Ambiguous constructor-arg entries for index &quot;</span> + index, ele);
                        }
                        <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">//ConstructorArgumentValues&#x6709;&#x4E2A; Map&lt;Integer, ValueHolder&gt; indexedArgumentValues = new LinkedHashMap&lt;Integer, ValueHolder&gt;(0)&#x6765;hold&#x53C2;&#x6570;</span>
                            bd.getConstructorArgumentValues().addIndexedArgumentValue(index, valueHolder);
                        }
                    }
                    <span class="hljs-keyword">finally</span> {
                        <span class="hljs-comment">//&#x51FA;&#x6808;&#xFF1B;&#x7B80;&#x5355;&#x7684;&#x6808;&#x7ED3;&#x6784;&#x6765;&#x8DDF;&#x8E2A;&#x903B;&#x8F91;&#x4F4D;&#x7F6E;&#x4E2D;&#x89E3;&#x6790;&#x8FC7;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x8BB0;&#x5F55;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x7684;&#x5427;</span>
                        <span class="hljs-keyword">this</span>.parseState.pop();
                    }
                }
            }
            <span class="hljs-keyword">catch</span> (NumberFormatException ex) {
                error(<span class="hljs-string">&quot;Attribute &apos;index&apos; of tag &apos;constructor-arg&apos; must be an integer&quot;</span>, ele);
            }
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">//&#x4E0E;&#x4E0A;&#x65E0;&#x4E8C;</span>
                <span class="hljs-keyword">this</span>.parseState.push(<span class="hljs-keyword">new</span> ConstructorArgumentEntry());
                Object value = parsePropertyValue(ele, bd, <span class="hljs-keyword">null</span>);
                ConstructorArgumentValues.ValueHolder valueHolder = <span class="hljs-keyword">new</span> ConstructorArgumentValues.ValueHolder(value);
                <span class="hljs-keyword">if</span> (StringUtils.hasLength(typeAttr)) {
                    valueHolder.setType(typeAttr);
                }
                <span class="hljs-keyword">if</span> (StringUtils.hasLength(nameAttr)) {
                    valueHolder.setName(nameAttr);
                }
                valueHolder.setSource(extractSource(ele));
                bd.getConstructorArgumentValues().addGenericArgumentValue(valueHolder);
            }
            <span class="hljs-keyword">finally</span> {
                <span class="hljs-keyword">this</span>.parseState.pop();
            }
        }
    }
</code></pre>
<p>&#x518D;&#x7740;&#x91CD;&#x5206;&#x6790;&#x4E00;&#x4E0B;Object value = parsePropertyValue(ele, bd, null); </p>
<ol>
<li>&#x89E3;&#x6790;&#x5C5E;&#x6027;&#x503C;,&#x89E3;&#x6790;property &#x6216;&#x8005; constructor-arg;&#x5982;&#x4E0B;<pre><code class="lang-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;src.HelloWorld&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;beanA&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;beanA&quot;</span> /&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&#x59D3;&#x540D;&quot;</span> /&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;a&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;list&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;meta1&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;meta1value&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
</li>
</ol>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x53EA;&#x6709;&#x4E24;&#x4E2A;&#x5730;&#x65B9;&#x8C03;&#x7528; 
&#x2460;.&#x89E3;&#x6790;&#x5C5E;&#x6027;property&#x5143;&#x7D20;&#x7684;&#x65F6;&#x5019;parsePropertyValue(ele, bd, propertyName) 
&#x2461;.&#x89E3;&#x6790;&#x6784;&#x9020;&#x53C2;&#x6570;constructor-arg&#x5143;&#x7D20;&#x7684;&#x65F6;&#x5019; parsePropertyValue(ele, bd, null)</p>
<p>&#x68C0;&#x67E5;&#x914D;&#x7F6E;&#x662F;&#x5426;&#x6B63;&#x786E; &#x6700;&#x591A;&#x53EA;&#x80FD;&#x6709;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF1A;ref&#xFF0C;value,&#x5B50;&#x5143;&#x7D20;(ref&#xFF0C;value,list,set array &#x7B49;&#x7B49;&#x5F62;&#x5F0F;&#x7684;&#x5143;&#x7D20;) &#xFF1B;</p>
<p>&#x89E3;&#x6790;&#x5B50;&#x5143;&#x7D20;&#xFF0C;ref&#xFF0C;value,list,set array&#x2026;..&#x7B49;&#x7B49;</p>
<pre><code class="lang-java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">parsePropertyValue</span><span class="hljs-params">(Element ele, BeanDefinition bd, String propertyName)</span> </span>{
        String elementName = (propertyName != <span class="hljs-keyword">null</span>) ?
                        <span class="hljs-string">&quot;&lt;property&gt; element for property &apos;&quot;</span> + propertyName + <span class="hljs-string">&quot;&apos;&quot;</span> :
                        <span class="hljs-string">&quot;&lt;constructor-arg&gt; element&quot;</span>;

        <span class="hljs-comment">// &#x6700;&#x591A;&#x53EA;&#x80FD;&#x6709;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#xFF1A;ref&#xFF0C;value,&#x5B50;&#x5143;&#x7D20;(ref&#xFF0C;value,list,set array &#x7B49;&#x7B49;&#x5F62;&#x5F0F;&#x7684;&#x5143;&#x7D20;) &#x7B49;&#x7B49;</span>
        <span class="hljs-comment">/**
        *&lt;constructor-arg name=&quot;a&quot; &gt;
        *&lt;value &gt;1&lt;/value&gt;
        *&lt;/constructor-arg&gt;
        */</span>
        NodeList nl = ele.getChildNodes();
        Element subElement = <span class="hljs-keyword">null</span>;
        <span class="hljs-comment">/**&#x5982;&#x679C;&#x5199;&#x6CD5;&#x662F;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x7684;&#x5D4C;&#x5957;&#x5B50;&#x5143;&#x7D20;&#x7684;&#x8BDD; &#x5C31;&#x8981;&#x8FDB;&#x5165;parsePropertySubElement&#x89E3;&#x6790;&#x5D4C;&#x5957;&#x5B50;&#x5143;&#x7D20;&#x4E86;
        *&lt;constructor-arg name=&quot;a&quot; &gt;
        *&lt;value &gt;1&lt;/value&gt;
        *&lt;/constructor-arg&gt;
        */</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nl.getLength(); i++) {
            Node node = nl.item(i);
            <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> Element &amp;&amp; !nodeNameEquals(node, DESCRIPTION_ELEMENT) &amp;&amp;
                    !nodeNameEquals(node, META_ELEMENT)) {
                <span class="hljs-comment">// Child element is what we&apos;re looking for.</span>
                <span class="hljs-keyword">if</span> (subElement != <span class="hljs-keyword">null</span>) {
                    error(elementName + <span class="hljs-string">&quot; must not contain more than one sub-element&quot;</span>, ele);
                }
                <span class="hljs-keyword">else</span> {
                    subElement = (Element) node;
                }
            }
        }

        <span class="hljs-keyword">boolean</span> hasRefAttribute = ele.hasAttribute(REF_ATTRIBUTE);
        <span class="hljs-keyword">boolean</span> hasValueAttribute = ele.hasAttribute(VALUE_ATTRIBUTE);
        <span class="hljs-comment">//1.&#x5982;&#x679C; ref &#x548C; value&#x90FD;&#x5B58;&#x5728;  &#x629B;&#x5F02;&#x5E38;</span>
        <span class="hljs-comment">//2.&#x5982;&#x679C;ref&#x6216;&#x8005;value&#x5B58;&#x5728; &#x4E00;&#x4E2A;&#x5E76;&#x4E14; subElement&#x4E5F;&#x5B58;&#x5728;  &#x629B;&#x5F02;&#x5E38;</span>
        <span class="hljs-keyword">if</span> ((hasRefAttribute &amp;&amp; hasValueAttribute) ||
                ((hasRefAttribute || hasValueAttribute) &amp;&amp; subElement != <span class="hljs-keyword">null</span>)) {
            error(elementName +
                    <span class="hljs-string">&quot; is only allowed to contain either &apos;ref&apos; attribute OR &apos;value&apos; attribute OR sub-element&quot;</span>, ele);
        }

<span class="hljs-comment">//&#x5982;&#x679C;&#x662F;ref&#xFF1B;&#x8FD4;&#x56DE;RuntimeBeanReference implements BeanReference&#xFF1B;&#x6709;beanName&#xFF0C;toParent&#xFF0C;source&#x7B49;&#x5C5E;&#x6027;</span>
        <span class="hljs-keyword">if</span> (hasRefAttribute) {
            String refName = ele.getAttribute(REF_ATTRIBUTE);
            <span class="hljs-keyword">if</span> (!StringUtils.hasText(refName)) {
                error(elementName + <span class="hljs-string">&quot; contains empty &apos;ref&apos; attribute&quot;</span>, ele);
            }
            RuntimeBeanReference ref = <span class="hljs-keyword">new</span> RuntimeBeanReference(refName);
            ref.setSource(extractSource(ele));
            <span class="hljs-keyword">return</span> ref;
        }
        <span class="hljs-comment">//&#x5982;&#x679C;&#x662F;value&#xFF1B;&#x8FD4;&#x56DE;TypedStringValue&#xFF1B;&#x8BBE;&#x7F6E;&#x5C5E;&#x6027; value&#x548C;source </span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hasValueAttribute) {
            TypedStringValue valueHolder = <span class="hljs-keyword">new</span> TypedStringValue(ele.getAttribute(VALUE_ATTRIBUTE));
            valueHolder.setSource(extractSource(ele));
            <span class="hljs-keyword">return</span> valueHolder;
        }
        <span class="hljs-comment">//&#x5982;&#x679C;&#x662F;list&#xFF1B;&#x89E3;&#x6790;&#x4E00;&#x4E0B;&#x5B50;&#x5143;&#x7D20;</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (subElement != <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> parsePropertySubElement(subElement, bd);
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Neither child element nor &quot;ref&quot; or &quot;value&quot; attribute found.</span>
            error(elementName + <span class="hljs-string">&quot; must specify a ref or value&quot;</span>, ele);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
    }
<span class="hljs-comment">//&#x89E3;&#x6790;&#x5B50;&#x5143;&#x7D20;</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">parsePropertySubElement</span><span class="hljs-params">(Element ele, BeanDefinition bd, String defaultValueType)</span> </span>{
        <span class="hljs-comment">//&#x5982;&#x679C;&#x4E0D;&#x662F;&#x9ED8;&#x8BA4;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x5219;&#x6700;&#x7EC8;&#x8C03;&#x7528;public BeanDefinition parseCustomElement(Element ele, BeanDefinition containingBd) &#x6765;&#x89E3;&#x6790;&#xFF1B;</span>
        <span class="hljs-comment">//&#x7B2C;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x5206;&#x6790;&#x8FC7; &#x6839;&#x636E;&#x5143;&#x7D20;&#x9009;&#x62E9;&#x4E0D;&#x540C;&#x7684;&#x89E3;&#x6790;&#x5668;&#x6765;&#x89E3;&#x6790;&#xFF1B;</span>
        <span class="hljs-keyword">if</span> (!isDefaultNamespace(ele)) {
            <span class="hljs-keyword">return</span> parseNestedCustomElement(ele, bd);
        }
        <span class="hljs-comment">//&#x89E3;&#x6790;&lt;bean&gt;&#x5143;&#x7D20;&#xFF1B;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x672C;&#x6587;&#x6B63;&#x5728;&#x5206;&#x6790;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x6982;&#x8FF0;&#x4E86;</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, BEAN_ELEMENT)) {
            BeanDefinitionHolder nestedBd = parseBeanDefinitionElement(ele, bd);
            <span class="hljs-keyword">if</span> (nestedBd != <span class="hljs-keyword">null</span>) {
                nestedBd = decorateBeanDefinitionIfRequired(ele, nestedBd, bd);
            }
            <span class="hljs-keyword">return</span> nestedBd;
        }
        <span class="hljs-comment">//&#x5982;&#x679C;&#x662F;ref &#x5143;&#x7D20; RuntimeBeanReference</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, REF_ELEMENT)) {
            <span class="hljs-comment">// A generic reference to any name of any bean.</span>
            String refName = ele.getAttribute(BEAN_REF_ATTRIBUTE);
            <span class="hljs-keyword">boolean</span> toParent = <span class="hljs-keyword">false</span>;
            <span class="hljs-keyword">if</span> (!StringUtils.hasLength(refName)) {
                <span class="hljs-comment">// A reference to the id of another bean in the same XML file.</span>
                refName = ele.getAttribute(LOCAL_REF_ATTRIBUTE);
                <span class="hljs-keyword">if</span> (!StringUtils.hasLength(refName)) {
                    <span class="hljs-comment">// A reference to the id of another bean in a parent context.</span>
                    refName = ele.getAttribute(PARENT_REF_ATTRIBUTE);
                    toParent = <span class="hljs-keyword">true</span>;
                    <span class="hljs-keyword">if</span> (!StringUtils.hasLength(refName)) {
                        error(<span class="hljs-string">&quot;&apos;bean&apos;, &apos;local&apos; or &apos;parent&apos; is required for &lt;ref&gt; element&quot;</span>, ele);
                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
                    }
                }
            }
            <span class="hljs-keyword">if</span> (!StringUtils.hasText(refName)) {
                error(<span class="hljs-string">&quot;&lt;ref&gt; element contains empty target attribute&quot;</span>, ele);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
            }
            RuntimeBeanReference ref = <span class="hljs-keyword">new</span> RuntimeBeanReference(refName, toParent);
            ref.setSource(extractSource(ele));
            <span class="hljs-keyword">return</span> ref;
        }
        <span class="hljs-comment">//&#x89E3;&#x6790;idref</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, IDREF_ELEMENT)) {
            <span class="hljs-keyword">return</span> parseIdRefElement(ele);
        }
        <span class="hljs-comment">//&#x89E3;&#x6790;value</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, VALUE_ELEMENT)) {
            <span class="hljs-comment">/**&#x89E3;&#x6790; &#x4E0B;&#x9762;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x7684;
            * &lt;constructor-arg name=&quot;a&quot; &gt;
            *       &lt;value  type=&quot;java.lang.Integer&quot;  &gt;1&lt;/value&gt;
            * &lt;/constructor-arg&gt;
            * &lt;property name=&quot;name&quot;&gt;
            *      &lt;value   &gt;&#x59D3;&#x540D;&lt;/value&gt;
            * &lt;/property&gt;
            * 1.&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;type&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;new TypedStringValue(value)&#xFF1B;SpecifiedTypeName&#x662F;&#x7A7A;&#x4E32;&#xFF1B;
            * 2.&#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E86;type&#xFF0C;&#x518D;&#x5224;&#x65AD;&#x5F53;&#x524D;readerContext&#x662F;&#x5426;&#x6709;ClassLoader&#xFF0C;&#x5982;&#x679C;&#x6709;&#xFF0C;&#x5219;&#x5229;&#x7528;&#x53CD;&#x5C04;&#x751F;&#x6210;targetTypeName&#x7C7B;&#x578B;&#x7684; Class&#x5BF9;&#x8C61;&#xFF1B;&#x518D;&#x8FD4;&#x56DE;new TypedStringValue(value, targetType)&#xFF1B;&#x8FD9;&#x4E2A;targetType&#x5C31;&#x662F;Class&#x5BF9;&#x8C61;
            * 3.&#x5426;&#x5219;&#x7684;&#x8BDD;&#xFF0C;&#x8FD4;&#x56DE;new TypedStringValue(value, targetTypeName);targetType&#x5C31;&#x662F;&#x5168;&#x7C7B;&#x540D;&#x8DEF;&#x5F84;
            */</span>
            <span class="hljs-keyword">return</span> parseValueElement(ele, defaultValueType);
        }
        <span class="hljs-comment">//&#x89E3;&#x6790;null</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, NULL_ELEMENT)) {
            <span class="hljs-comment">// It&apos;s a distinguished null value. Let&apos;s wrap it in a TypedStringValue</span>
            <span class="hljs-comment">// object in order to preserve the source location.</span>
            TypedStringValue nullHolder = <span class="hljs-keyword">new</span> TypedStringValue(<span class="hljs-keyword">null</span>);
            nullHolder.setSource(extractSource(ele));
            <span class="hljs-keyword">return</span> nullHolder;
        }
        <span class="hljs-comment">//&#x89E3;&#x6790;array</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, ARRAY_ELEMENT)) {
            <span class="hljs-keyword">return</span> parseArrayElement(ele, bd);
        }
        <span class="hljs-comment">//list</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, LIST_ELEMENT)) {
            <span class="hljs-keyword">return</span> parseListElement(ele, bd);
        }
        <span class="hljs-comment">//set</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, SET_ELEMENT)) {
            <span class="hljs-keyword">return</span> parseSetElement(ele, bd);
        }
        <span class="hljs-comment">//map</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, MAP_ELEMENT)) {
            <span class="hljs-keyword">return</span> parseMapElement(ele, bd);
        }
        <span class="hljs-comment">//props</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (nodeNameEquals(ele, PROPS_ELEMENT)) {
            <span class="hljs-keyword">return</span> parsePropsElement(ele);
        }
        <span class="hljs-keyword">else</span> {
            error(<span class="hljs-string">&quot;Unknown property sub-element: [&quot;</span> + ele.getNodeName() + <span class="hljs-string">&quot;]&quot;</span>, ele);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
    }
</code></pre>
<p><img src="../../../images/20180508101030871.png" alt="20180508101030871"></p>
<p>3 &#x603B;&#x7ED3;
&#x81F3;&#x6B64;&#xFF0C;BeanDefinition&#x5C31;&#x5DF2;&#x7ECF;&#x89E3;&#x6790;&#x5B8C;&#x6210;&#x4E86;&#xFF01; 
&#x6211;&#x4EEC;&#x4E00;&#x8D77;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;</p>
<ol>
<li>&#x89E3;&#x6790; id&#xFF0C;name&#x5C5E;&#x6027;&#x653E;&#x5165;List aliases&#x4E2D;&#xFF1B;aliases&#x6301;&#x6709;&#x6240;&#x6709;&#x522B;&#x540D;</li>
<li>&#x68C0;&#x67E5;beanName&#xFF0C;&#x548C;aliases&#x662F;&#x5426;&#x8DDF;&#x4E4B;&#x524D;&#x6709;&#x91CD;&#x590D;&#xFF1B;&#x56E0;&#x4E3A;&#x5F53;&#x524D;&#x7684;&#x5BF9;&#x8C61;BeanDefinitionParserDelegate&#x4E2D;&#x5C5E;&#x6027; Set usedNames &#x4F1A;&#x6301;&#x6709;&#x6240;&#x6709;&#x89E3;&#x6790;&#x51FA;&#x6765;&#x7684;beanName &#x548C; aliases&#xFF1B;</li>
<li>&#x89E3;&#x6790;&#x5143;&#x7D20;&#xFF0C;&#x5C06;xml&#x4E2D;&#x7684;&#x6240;&#x6709;&#x5143;&#x7D20;&#x89E3;&#x6790;&#x6210;AbstractBeanDefinition&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5C5E;&#x6027;&#xFF1B;</li>
<li>&#x89E3;&#x6790;&#x5B8C;&#x4E86;&#x62FF;&#x5230;AbstractBeanDefinition&#x7684;&#x5B9E;&#x4F8B;&#x4E4B;&#x540E;&#xFF1B;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;BeanDefinitionHolder&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF1B; &#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x6301;&#x6709; AbstractBeanDefinition&#xFF0C;beanName&#xFF0C;aliases&#xFF1B;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#xFF1B;&#x5E76;&#x4E14;&#x8FD4;&#x56DE;holder&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF1B;</li>
</ol>
<p>&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x5BF9;BeanDefinition&#x5C31;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x521D;&#x6B65;&#x7684;&#x6982;&#x5FF5;&#x4E86;&#xFF1B;&#x90A3;&#x4E48;&#x62FF;&#x5230;&#x4E86;BeanDefinition&#x4E4B;&#x540E;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x5462;&#xFF1F;&#x8BF7;&#x770B;&#x4E0B;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="springSourceCode_analysis_2_80169701.html" class="navigation navigation-prev " aria-label="Previous page: (转)Spring源码分析(二)Spring怎么扩展解析xml接口的">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="springSourceCode_analysis_4_80226375.html" class="navigation navigation-next " aria-label="Next page: (转)Spring源码解析(四)Spring是怎么处理BeanDefinition的？">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"(转)Spring源码分析(三)Spring是如何把元素解析成BeanDefinition对象的","level":"1.5.7.6","depth":3,"next":{"title":"(转)Spring源码解析(四)Spring是怎么处理BeanDefinition的？","level":"1.5.7.7","depth":3,"path":"Spring/转载/Spring源代码分析/springSourceCode_analysis_4_80226375.md","ref":"Spring/转载/Spring源代码分析/springSourceCode_analysis_4_80226375.md","articles":[]},"previous":{"title":"(转)Spring源码分析(二)Spring怎么扩展解析xml接口的","level":"1.5.7.5","depth":3,"path":"Spring/转载/Spring源代码分析/springSourceCode_analysis_2_80169701.md","ref":"Spring/转载/Spring源代码分析/springSourceCode_analysis_2_80169701.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Spring/转载/Spring源代码分析/springSourceCode_analysis_3_80223871.md","mtime":"2019-05-24T09:13:53.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-09-25T09:59:36.899Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

